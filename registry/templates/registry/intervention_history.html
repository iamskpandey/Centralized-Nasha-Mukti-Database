{% extends 'registry/base.html' %}

{% block title %}Intervention History - {{ beneficiary.name }}{% endblock %}

{% block content %}
<div class="detail-page-header">
  <div>
    <h1>ğŸ“‹ Intervention History</h1>
        <p style="margin: 0.5rem 0 0 0; font-size: 1.1rem; opacity: 0.95;">{{ beneficiary.name }}</p>
  </div>
  <div class="header-actions">
    <a href="{% url 'beneficiary_detail' beneficiary.pk %}" class="btn-white">
      <span>â† Back to Details</span>
    </a>
  </div>
</div>

<div class="info-card-grid" style="margin-bottom: 2rem;">
  <div class="info-card">
    <div class="info-card-label">Unique ID</div>
    <div class="info-card-value">{{ beneficiary.unique_id }}</div>
  </div>
  <div class="info-card">
    <div class="info-card-label">Registered Center</div>
    <div class="info-card-value">
      {{ beneficiary.center.name }}, {{ beneficiary.center.city }}
    </div>
  </div>
  <div class="info-card">
    <div class="info-card-label">Total Interventions</div>
    <div class="info-card-value">{{ interventions.count }}</div>
  </div>
  <div class="info-card">
    <div class="info-card-label">Registration Date</div>
    <div class="info-card-value">
      {{ beneficiary.date_registered|date:"d M Y" }}
    </div>
  </div>
</div>

<div class="intervention-timeline">
  <div class="section-header">
    <h3>
      ğŸ“œ Complete Intervention Timeline
      <span class="section-badge">{{ interventions.count }}</span>
    </h3>
  </div>

  {% for intervention in interventions %}
  <div class="timeline-item">
    <div class="timeline-dot"></div>
    <div class="timeline-card">
      <div class="timeline-header">
        <div class="timeline-date">
          ğŸ“… {{ intervention.date_of_intervention|date:"d M Y, h:i A" }}
        </div>
        {% if user.userprofile.role != 'state_admin' %}
        <div class="timeline-actions">
          <a
            href="{% url 'edit_intervention' intervention.pk %}"
            class="btn-small"
            >Edit</a
          >
          <a
            href="{% url 'delete_intervention' intervention.pk %}"
            class="btn-small-danger"
            >Delete</a
          >
        </div>
        {% endif %}
      </div>
      <div class="timeline-content">
        <p>
          <strong>Type:</strong>
          <span>{{ intervention.get_intervention_type_display }}</span>
        </p>
        <p>
          <strong>Logged by:</strong>
          <span>{{ intervention.staff_member.username }}</span>
        </p>
        {% if intervention.details %}
        <div>
          <strong>Details:</strong>
          <div class="timeline-details">{{ intervention.details }}</div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
  {% empty %}
  <div class="empty-state">
    <div class="empty-state-icon">ğŸ“­</div>
    <p>No interventions have been logged for this beneficiary yet.</p>
  </div>
  {% endfor %}
</div>
{% endblock %}
